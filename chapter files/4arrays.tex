\section{Introduction}

For a quantum computer, multiple qubits are needed that are capable of interacting with each other. 
Thus, we need to make an array of the tweezers described in \cref{ch:tweezer}, spaced from each other in the order of micrometers. 
This can be done by sending several laser beams to the objective, each under slightly different angles. 
Experimentally, this could be realized using an \ac{AOD}: a device that diffracts light off of a sound wave in a crystal, where the degree of diffraction is controlled by a \ac{RF} signal. 
By using 2 AODs in an orthogonal configuration, each supplied by a superposition of RF signals (see \cref{fig:CrossAOD}), 2D arrays of optical tweezer were successfully realized \cite{Manuel2016}. 

Nevertheless, one drawback of this method is that there is little flexibility in varying the individual laser spot intensities because of the crossed configuration.
Therefore, it was proposed to use holography methods for producing arrays of optical tweezers instead \cite{Bergamini2004}, making use of a \acf{SLM}.
Using an SLM for tweezer arrays has the advantage that it is possible to dynamically adapt the hologram, correcting for variation within trap depths of the array \cite{Nogrette2014}. 
At the same time, SLMs also allow for the correction of optical aberrations introduced by the optics in the setup \cite{Bijnen2015}.
Lastly, using the holographic method, it is even possible to make 3D arrays of tweezers \cite{DiLeonardo2007,Barredo2016}, though we will limit ourselves to 2D arrays in this work.

In the following section \ref{sec:SLM} we will introduce the working principle of the SLM, as well as the algorithm used to compute the holograms needed.
Next, in \cref{sec:SLMoperatoin} we elaborate how we used the SLM in the practice. 
Finally, in \cref{sec:ArraysResults} we present the measured spot arrays.



\section{The Spatial Light Modulator}\label{sec:SLM}

A spatial light modulator is in essence a device that can imprint a computer generated hologram onto a beam of light, allowing the spatial shaping of this light.
Different types of SLMs can manipulate properties of light like amplitude, phase and polarization.
In this work a phase-only reflective SLM was used, which as the name suggests can only control local phase of the incoming light field.
The use of phase-only SLMs has been extensively covered in our group by, for example by \cite{Bijnen2015,Dijk2012,Bijnen2013}. 

The modulating works by deploying a pixel array, where each pixel houses a liquid birifringent crystal.
By applying a voltage (electric field) over the pixel, the orientation of the liquid crystal molecules change, changing their effective refractive index.
This principle is sketched in \cref{fig:LCoS}.
Because of crystals are birifringent they posses refractive indices among perpendicular axes, commonly referred to as the ordinary and extraordinary refractive indices respectively ($n_o$ and $n_e$). 
If the light travels a distance $t$ in a crystal unit of the SLM, the phase retardation will be $\phi_o = k t n_o$ and $\phi_e(V) = k t n_e(V)$ respectively (only the extraordinary axis can be modulated), such that the phase retarder can be represented by the Jones matrix \cite{Guzman2017}

\begin{equation}\label{eq:JonesMatrix}
    M = e^{i \phi_0} 
    \begin{pmatrix}
        e^{i(\phi_e-\phi_o)} & 0\\
        0 & 1
    \end{pmatrix}.
\end{equation}
Thus the phase retardance $\phi$ as a function of the applied voltage $V$ is \cite{Guzman2017}, using the birifringence parameter $\Delta n= n_e-n_o$

\begin{equation}\label{eq:ElectroOpticResponse}
    \phi(V) = k t(n_e(V) - n_0) t = \frac{2\pi}{\lambdaup}t \Delta n(V).
\end{equation}
To obtain voltage control over each individual pixel, the display is manufactured on a layer of silicon, making use of various semiconductor manufacturing technologies.
As a result of diffraction from the various pixels, one can create arbitrary intensity patterns in in the focal plane of a lens.
This concept is sketched in \cref{fig:SLMLens} and further explained in the next section.


\begin{figure}
	\begin{subfigure}{.39\textwidth}
		\includegraphics[height=4.25cm]{figures/crossAOD.pdf}
		\caption{}
		\label{fig:CrossAOD}
	\end{subfigure}
	\hfill
	\begin{subfigure}{.59\textwidth}
		\includegraphics[height=4.25cm]{figures/LCoS.png}
		\caption{}
		\label{fig:LCoS}
	\end{subfigure}
	\caption{\textbf{a)} Two \ac{AOD}s in crossed configuration, used to make a 2D spot array. Figure from \cite{Cooper2018}. 
	\textbf{b)} The orientation of the liquid crystal cells changing as a function of the applied electric field \textit{E}. 
	Figure from \cite{Guzman2017}.}
\end{figure}


\subsection{Diffraction for Spot Arrays}\label{sec:PropagationDerivation}

We will now delve deeper in the diffraction from the SLM hologram, limiting ourselves to producing spot arrays.
First consider plane of the SLM, denoted in \cref{fig:SLMLens} by the Cartesian coordinates $(x',y',z=0)$. 
If we label the pixels of the SLM with the letter $j$, the phase retardance of this pixel is thus $\phi_j(x'_j,y'_j)$.
Now, consider a laser with intensity distribution $|E_i(x',y')|^2$ reflecting off of the SLM: it will pick up a phase factor such that after the SLM, the field is described as $E_i e^{i\phi(x',y')}$, as shown in \cref{fig:SLMLens}. 
The light field will interfere with itself, until at infinity (or approximately in the focal (Fourier) plane $z'=f$, $z=0$ of a lens) the distribution evolves to $|E_f(x,y,z)|^2$, where $(x,y,z)$ are Cartesian coordinates with the origin in the focus point of the lens as denoted in \cref{fig:SLMLens}.

To see how this works, consider the focal plane or Fourier plane of a lens after the SLM\footnote{In reality, the distance between the SLM and the microscope objective is not the focal length $f$ of the objective, but this will lead to an additional phase factor which can be neglected in practice \cite{Bijnen2013}.}.
In the Fourier plane, the spots in the array will be labeled as $m$, which in general have coordinates $(x_m, y_m, z_m)$ in the Fourier plane, see \cref{fig:SLMgeometry}.
As result of traveling from the pixel $j$ to the trap $m$, under paraxial approximation it can be derived the light field will experience a phase shift $\Delta_j^m$ \cite{DiLeonardo2007}

\begin{figure}
	\centering
	\includegraphics[width = 13cm]{figures/SLMfigure.pdf}
	\caption{Field with intensity distribution $|E_i|^2$ reflects off of the   rectangular SLM, which due to its finite size acts as an aperture in the short-axis direction.
	Also the SLM imprints a phase mask $e^{i\phi(x',y')}$ onto the laser.
	The lens (microscope objective) makes the resulting spot array $|E_f|^2$ in its focal plane.
	Shown on top: two Cartesian coordinate systems in the SLM and focal plane respectively. 
	Figure adapted from \cite{Labuhn2016}.}
	\label{fig:SLMLens}
\end{figure}

\begin{equation}\label{eq:PropagationPhase}
    \Delta_j^m = 
    \frac{2\pi z_m}{\lambdaup f^2} ({x'}_{j}^{2} + {y'}_{j}^{2}) 
    + \frac{2\pi}{\lambdaup f}(x'_j x_m + y'_j y_m).
\end{equation}
The SLM imprints a phase $\phi(x',y') = \phi_j$, leading to a complex SLM plane for pixel $j$ of

\begin{equation}\label{eq:SLMassumption}
    E_j(x',y') = E_j e^{i \phi_j}.
\end{equation}
In the Fourier plane, the contributions for the different pixels will interfere with each other.
We can find the complex light field $V_m$ (for this section, we will denote the complex light field in the Fourier plane as $V$ similar to \cite{DiLeonardo2007}) for trap $m$ by summing over $N$ pixels $j$ using \cref{eq:PropagationPhase,eq:SLMassumption} \cite{Leseleuc2018}

\begin{equation}\label{eq:DiffractionFormula}
    V_m = e^{i k \left(2 f + z_m\right)}
    \frac{d^2}{i \lambdaup f} \sum_{j=1}^N E_j e^{i(\phi_j - \Delta_j^m)},
\end{equation}
which is essentially using a discrete version of the Fresnel diffraction integral, where $d$ is the pixel pitch of the SLM. 
In \cref{eq:DiffractionFormula}, we can assume uniform illumination of the SLM such that the amplitude is the same everywhere on the SLM or $|E_i| = 1$.
This assumption cannot possibly be valid: we illuminate the SLM with a Gaussian beam from an optical fiber.
However, as will become clear in a moment, the input intensity on the SLM will have no influence on the intensities in the focal plane and this assumption can in fact be used without loss of generality.
In addition, we are really only interested in the intensity $I_m =|V|^2$ of each spot, not the phase.
Omitting the pre-factors in \cref{eq:DiffractionFormula} thus yields

\begin{equation}\label{eq:Vm}
    V_m \propto \sum_{j} e^{i(\phi_j - \Delta_j^m)}.
\end{equation}
This equation gives the complex field amplitude for spot $m$, given a hologram $\phi_j$.
While \cref{eq:Vm} can be used to compute intensities of 3D spot arrays, an instructive example is setting $z=0$ first \cite{DiLeonardo2007}, for which the quadratic term of \cref{eq:PropagationPhase} disappears.
Substituting the latter term of \cref{eq:PropagationPhase} in \cref{eq:Vm} yields a 2D array of spots with amplitudes 

\begin{equation}\label{eq:2Dcase}
    V_m \propto \sum_j e^{i\phi_j} \exp{\left(
    - i 2\pi \left[
    \frac{x_m}{\lambdaup f} x_j + \frac{y_m}{\lambdaup f} y_j
    \right]
    \right)},
\end{equation}
Which is the 2D \ac{DFT} of $e^{i\phi}$ evaluated at spatial frequencies $x_m/\lambdaup f$ and $y_m/\lambdaup f$ in $x$ and $y$ respectively \cite{Bijnen2015,DiLeonardo2007}, similar to \cref{eq:FraunhoferDiffractionIntegral}.
Using \cref{eq:2Dcase} has the advantage that the DFT is much faster to evaluate than the general case of the diffraction formula \cref{eq:Vm} using the \ac{FFT}.
In this work, we only use 2D arrays and could in principle use \cref{eq:2Dcase} to speed up calculations.
Because we only computed a small number of holograms, we simply used \cref{eq:Vm}.

\subsection{Computing the Hologram}\label{sec:GSW}

\Cref{eq:Vm} gives the amplitudes of an array of spots given an array of phases $\phi_j$, but we are interested in the reverse problem: what is the hologram $\phi_j$ to be applied, such that we get the spot array of intensities $|V_m|^2$? 
As the equations describing light propagation are time-symmetric, this phase will be the result of $M$ coherent light sources radiating with $w_m e^{i \theta_m}$, picking up a propagation phase described by \cref{eq:PropagationPhase}, leading to a complex amplitude in the \ac{SLM} plane of \cite{DiLeonardo2007,Leseleuc2018}

\begin{equation}\label{eq:InterferencePattern}
    E_j (x',y') = \sum_m w_m \exp{
    i\left(\Delta_j^m + \theta_j\right)
    }.
\end{equation}
But producing the the light field in \cref{eq:InterferencePattern} requires doing phase as well as amplitude modulation, which is not possible: the SLM can only do phase modulation.
So in this step in the algorithm, we take the argument of  \cref{eq:InterferencePattern} yielding the following hologram

\begin{equation}\label{eq:Argument}
    \phi_j = \text{arg}\left\{
     \sum_m w_m \exp{
    i\left(\Delta_j^m + \theta_j\right)
    }
    \right\}.
\end{equation}
But the lack of amplitude modulation leads to a loss of information, and the hologram produced by \cref{eq:Argument} will not produce the result we seek.
The solution to this problem was solved by \cite{Gerschberg1972}, who pioneered the \ac{IFTA} algorithm or Gerschberg-Saxton algorithm.
The core idea of the algorithm is to virtually propagate light between SLM and focal planes, using (inverse) Fourier transforms like \cref{eq:2Dcase}.
In each propagation step, the hologram in the SLM plane and the computed pattern in the Fourier plane are updated in an iterative fashion, until a solution (the desired pattern and the corresponding hologram) are obtained.
For a more detailed description of an implementation of IFTA algorithms the reader is referred to \cite{Bijnen2015,Bijnen2013}.
A key advantage of using these kind of algorithms is that \cref{eq:Vm}: each pixel contributes to individual spot.
As a result, using this algorithm, no knowledge about the laser input field is needed, which can be hard to determine exactly in practice.

For 3D spot arrays, Fourier transforms cannot be used, and the algorithm was extended using \cref{eq:Vm,eq:Argument} by \cite{DiLeonardo2007}. 
This algorithm is called the \ac{GSW} algorithm, which is sketched in \cref{fig:GSWalgorithm}.

\begin{figure}
	\centering
	\begin{subfigure}{.56\textwidth}
		\centering
		\includegraphics[height=5.3cm]{figures/SLMgeometry.pdf}
		\caption{}
		\label{fig:SLMgeometry}
	\end{subfigure}
	\begin{subfigure}{.43\textwidth}
		\centering
		\includegraphics[height=5.3cm]{figures/WeightedGerschbergSaxton.pdf}
		\caption{}
		\label{fig:GSWalgorithm}
	\end{subfigure}
	\caption{\textbf{a)} SLM plane with phases $\phi_j(x,',y',z=0)$ for pixel $j$, as well as the focal plane or Fourier plane with trap coordinates for trap $m$ of $(x_m,y_m,z_m)$. 
		Figure from \cite{DiLeonardo2007}. 
		\textbf{b)} The \ac{GSW} algorithm visualized.
		The light field is virtually propagated between the SLM and focal planes using \cref{eq:Vm,eq:Argument}, continuously updating the weight factors $w_m^k$ as well as the hologram $\phi_m^k$.}
	\label{fig:GerschbergSaxton}
\end{figure}

\subsubsection*{The GSW Algorithm}

\begin{itemize}
    \item Starting with hologram $\phi_j^k$ diffraction equation \cref{eq:Vm} is used to compute the complex amplitudes of the spot array $V_m^{k+1}$. 
    
    \item From the amplitudes, the new weight factors $w_m^k$ and phases $\theta_m^k$ are computed, which are used to compute a new hologram using the interference equation \cref{eq:Argument}.
    
    \item The iteration counter $k$ is increased, the hologram is updated and the steps above are repeated.
\end{itemize}
The algorithm starts with a hologram hologram, $\phi_j^{k=0}$ is computed by using \cref{eq:Argument} for an array of traps of uniform intensities $w_m^{k=0} = 1$ and random phases $\theta_m^{k=0}$.
After each iteration, the diffraction efficiency $e$ (the real part of the complex interference pattern) and the uniformity $u$ of the array $V_m$ should increase until convergence, yielding a set of target amplitudes $V_m$ as well as a hologram $\phi_j$ that produces this set of amplitudes.
The definitions of the diffraction efficiency $e$ and uniformity $u$ are 

\begin{equation}\label{eq:EfficiencyUniformity}
    e = \frac{1}{M}\sum_m I_m = \frac{1}{M}\sum_m |V_m|^2, 
    \quad 
    u = 1-\frac{\text{max}(I_m)-\text{min}(I_m)}{\text{max}(I_m)+\text{min}(I_m)},
\end{equation}
and are evaluated after each iteration $k$. 
The algorithm stops if the user-defined minimum criteria for diffraction efficiency or uniformity are met.

\subsubsection*{Implementation}

The algorithm was implemented in Python by Ivo Knottnerus as part of his PhD research.
Because the SLM has $\sim 2$ million pixels, converting to and from the SLM plane, so performing equations \cref{eq:Vm,eq:Argument} can be time consuming depending on the desired pattern.
Therefore, these computations are performed on a graphics card using the \textit{PyOpenCL} library. 
After a couple tens of iteration steps, we typically see the diffraction efficiency convergence to $e \sim 0.93$.
The theoretically computed uniformity will continue to increase indefinitely, but is typically already on the order $u \sim 0.999$ after $\sim 10^2$ iterations.
A typical hologram using the algorithm is shown in \ref{fig:SLMphase}a as well as \ref{fig:HologramPattern}.


\section{Operating the SLM}\label{sec:SLMoperatoin}

Because the SLM used previously in our group suffered from amplitude modulation \cite{Bijnen2015,Dijk2012}, an unwanted effect, we purchased a newer model SLM. Specifically, the Meadowlark E-series 1920 x 1200 SLM.
A few specifications of the device are presented in \cref{table:SLMspecs}.
In the next section, we will elaborate upon some other practical considerations that have to be taken into account in operating the SLM.

\begin{table}[h]
    \centering
    \caption{Key specifications of the Meadowlark SLM.}
    \label{table:SLMspecs}
    \begin{tabular}{l | l}
        \textbf{Specification}              & \textbf{Value}        \\ \hline 
        Array size                          & 15.4 x 9.6 mm         \\ \hline
        Resolution                          & 1920 x 1200 pixels    \\ \hline
        Bit depth                           & 8 bit                 \\ \hline
        Diffraction efficiency (785 nm)  & 76-79\%   
    \end{tabular}
\end{table}


\subsection{Calibrating the Electro-Optical Response}

The refractive index $\Delta n(V)$ and therefore the light retardation $\phi(V)$ of \cref{eq:ElectroOpticResponse} are not necessarily linear as a function of the applied voltage.
Thus it is needed to calibrate the electro-optic response of the \ac{SLM}, which equates to measuring the retardation $\phi$ as a function of the applied voltage $V$. 
This calibration serves two purposes:

\begin{enumerate}
    \itemsep=0pt
    
    \item Ensure the minimum to the maximum phase retardation corresponds to a $2\pi$ (one wave) phase retardation.
    
    \item Linearize this electro-optical response curve. 
\end{enumerate}
The calibration has to be performed because each individual SLM has a slightly different electro-optical response. 
Furthermore, it is wavelength specific, which is why we performed it for the wavelength relevant for Rb experiments at 820 nm. 
Measuring the electro-optical response directly is impossible because the light field oscillates with frequencies in the THz regime.
There are a variety of methods to measure it indirectly for a phase-only \ac{SLM}, however \cite{Li2019}.
We chose the diffractive calibration method, originally proposed by \cite{Zhang1994}.

The method works by applying a variety of Ronchi gratings onto the SLM, see \cref{fig:LUTCalibrationSetup}.
This is a pattern consisting of $M$ periods $w=8$ pixels in the horizontal direction and a vertical height $H$ of alternating gray values $L_1$ and $L_2$.
Gray values are 8 bit number representing the degree of modulation where 0 (white) mean no voltage while 255 (black) is maximum voltage. 
Assuming amplitude modulation between different gray levels is negligible (a fair assumption for phase-only SLMs), the electric field just after the SLM is proportional to the phase transmittance given by summing over the gratings $m$ \cite{Zhang1994}

\begin{figure}
	\begin{subfigure}{.54\linewidth}
		\flushleft
		\includegraphics[height=4.1cm]{figures/LUTcalibrationSetup.pdf}
		\caption{}
		\label{fig:LUTCalibrationSetup}
	\end{subfigure}
	\hfill
	\begin{subfigure}{.45\linewidth}
		\flushright
		\includegraphics[height=4.1cm]{figures/LUTplot.pdf}
		\caption{}
		\label{fig:LUTcalibration}
	\end{subfigure}
	\caption{\textbf{a)} Ronchi grating on the SLM with gray values $L_1$ and $L_2$. 
	The diffraction order are separated using a $f=400$ mm lens. 
	Other diffraction orders than $+1$ are blocked using an iris. 
	\textbf{b)} Normalized power in the first order as a (\textcolor{red}{red}) and the fitted voltage response (\textcolor{blue}{blue}) as a function of the applied gray level $L_1 \in (0-255)$.}
\end{figure}

\begin{equation}\label{eq:FieldAfterSLM}
    f(x',y') = \sum_{m=0}^{M-1} \left\{
    \operatorname{rect}\left(\frac{x'-m w - w/4}{w/2}\right) + e^{i \phi(L)} \operatorname{rect}\left(\frac{x'- m w - 3 w/4}{w/2}\right)
    \right\},
\end{equation}
where $\operatorname{rect}(\cdot)$ is the rectangular function. 
According to Fourier optics, if we place a lens after the SLM, the field in the \textit{Fourier} plane of the lens is the Fourier transform of the field after the SLM, as derived in \cref{eq:FraunhoferDiffractionIntegral} as well as in \cref{eq:2Dcase}.
The intensity is thus for $y=0$ (we separate the different orders in the $x$-direction around $y=0$) the 2D Fourier transform $F = \mathcal{F}(f)$ \cite{Zhang1994}

\begin{equation}\label{eq:FourierIntensity}
    |F(p,0)|^2=
    \frac{M^2 w^2}{2}\operatorname{sinc}^2\left(\frac{M p w}{2}\right) \times
    \frac{1 + \cos{\left[\phi(L)+p w/2\right]}}{\cos^2(p w/4)}.
\end{equation}
In \cref{eq:FourierIntensity} $p=2\pi x/\lambdaup f$ is the Fourier transformed spatial coordinate. The intensity in the first order ($p=\pm 2\pi/w$) is

\begin{equation}\label{eq:IntensityFirstOrder}
    I_1(\phi) =
    \frac{8M^2w^2}{\pi^2} \left( 
    1-\cos{\phi(L)}
    \right),
\end{equation}
which we will use to fit the measurement data. Experimentally, we load a sequence of Ronchi gratings onto the SLM, looping $L_1$ from the minimum to the maximum gray value, while keeping $L_2$ constant. 
For our 8-bit SLM, this amounts to looping over 255 gray values, which we did with the help of an edited \textit{labVIEW} script from the manufacturer.
For each hologram, separate the multiple diffraction orders using a $f=400$ mm lens (such that the spacing between the various orders is sufficient) and an aperture and record the power in the first order using a power meter.

The results are shown in \cref{fig:LUTcalibration}. 
Also shown is the result of fitting \cref{eq:IntensityFirstOrder}: the voltage response as a function of gray level. 
This fit was done with a software program provided by the manufacturer.
This is also called the gamma curve or \ac{LUT}.
The LUT is what the SLM uses to connect the 8-bit gray level to 10-bit voltage levels in a linear fashion, ensuring the gray level range corresponds to $2\pi$ phase retardation.
As can be seen from \cref{fig:LUTcalibration}, the obtained LUT is rather non-linear, meaning the electro-optic for a linear LUT would be non-linear, as expected. 

Using our newly acquired LUT, we measured a diffraction efficiency in agreement with the specifications in \cref{table:SLMspecs}. 
The exact diffraction efficiency depends on the 'smoothness' of the pattern applied to the SLM: because of the pixelated nature the SLM can only approximate continuous patterns. 
More rapidly-varying patterns equals lower diffraction efficiency \cite{Labuhn2016}.

\subsection{Finite Aperture Size}\label{subsec:ApertureSize}

In order to make use of the maximum amount of degrees of freedom (pixels) the SLM has to offer, the active area should be fully illuminated.
However, because the incident beam is described by a Gaussian, this will lead to power loss as a result of light falling outside of the chip area.
The ideal incident waist size is thus a compromise between power efficiency on the one and amount of pixels used on the other hand.
We estimate this power loss by reflecting a Gaussian beam $G(x,y)$ having waist $w(z)$ and power $P_0$ off of a rectangular aperture of dimensions $(2S_x, 2S_y)$ where $S_{x,y}$ are the semi-widths of the aperture. 
The relative power transmission $P/P_0$ can be found by integrating the intensity of the beam \cref{eq:GaussianBeamIntensity} in Cartesian coordinates over the aperture

\begin{equation}\label{eq:RectAperturePower}
	\frac{P}{P_0} =
	\iint G(x,y) dA=
	\text{erf}\left(\frac{\sqrt{2}S_x}{w(z)}\right) \text{erf}\left(\frac{\sqrt{2}S_y}{w(z)}\right),
\end{equation}
If we use a beam with $1/e^2$ radius equal to the short semi-width SLM and using the aspect ratio from \cref{table:SLMspecs}, the power transmission is $\sim 95$\%.
So we barely use any power, while still almost using all of the pixels.
To obtain this waist, we direct the beam on the SLM from the Schäfter fiber collimator (\cref{sec:MeasuringTweezer}).
This collimator yields a beam with waist $w(z) = 4.8$ mm, about the size of the short semi-width $S_y = 4.9$ mm of the rectangular SLM.

\subsection{Demagnification}

To prevent excess loss of power, the $w = 4.8$ mm beam needs to be adapted to the $R = 2.0$ mm radius of the microscope objective. 
Thus the beam should be magnified by a factor $M=0.42$ (demagnified).
This is commonly done using a Keplerian telescope using two lenses $f_1$ and $f_2$ as shown in \ref{fig:SLMbeampath}a.
However, because we need some $30$ cm between the lens $f_2$ and the objective to accommodate (dichroic) mirrors, polarizing cubes and to leave room for future upgrades, we chose $f_2=30$ cm. 
Also knowing that $f_1=f_2/M$ and the total length of the telescope is $2f_1+2f_2$, this is already $203$ cm of beam path on the optical table. 
We borrowed a trick from our collaborators at the University of Amsterdam, where we use the SLM as the first lens of the system. 
In terms of the ABCD matrix formalism, the transfer matrix $\mathbf{M}$ for the latter is:

\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{figures/beamPathSLM.pdf}
	\caption{\textbf{a)}: Keplerian telescope with total length $2f_1+2f_2$. \textbf{b)}: Using the SLM as a lens, the total beam path has length $x+y$.}
	\label{fig:SLMbeampath}
\end{figure}

\begin{equation}\label{ABCD}
	\mathbf{M}=
	\begin{pmatrix}
		1 & y \\
		0 & 1
	\end{pmatrix}
	%
	\begin{pmatrix}
		1 & 0 \\
		-1/f_2 & 1
	\end{pmatrix}
	%
	\begin{pmatrix}
		1 & x \\
		0 & 1
	\end{pmatrix}
	%
	\begin{pmatrix}
		1 & 0 \\
		-1/f_1 & 1
	\end{pmatrix}.
\end{equation}
For substituting $x= f_2(1+f_1/f_2)$ and $y=f_2(1+f_2/f_1)$, \cref{ABCD} reduces to

\begin{equation}
	\mathbf{M}=
	\begin{pmatrix}
		-f_1/f_2 & 0\\
		0 & -f_2/f_1
	\end{pmatrix}.
\end{equation}
Which is the ABCD matrix for a beam expander. The total length is $x+y = 102 + 42.5 = 145$ cm for $f_2 = 300$ mm and $f_2/f_1=0.42$.
The Fresnel lens hologram used on the SLM (which is a quadratic polynomial) is shown in \ref{fig:SLMbeampath}b.
This pattern is superimposed on the spot array hologram in \ref{fig:SLMphase}a along with the other holograms described in this section. 
The sum of the hologram is computed modulo $2\pi$, which equals exactly one wave retardation.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{figures/hologram.png}
	\caption{
		Total phase mask applied on the SLM: \textbf{a)} Hologram obtained from the \ac{GSW} algorithm to generate the spot array.
		\textbf{b)} Lens phase applied to use the SLM as the first lens of a telescope with magnification $M=0.42$.
		\textbf{c)} Optical flatness correction pattern as provided by the manufacturer.
		\textbf{d)} Blazed grating, used to move the diffraction pattern away from the optical axis (zoomed in).
		\textbf{e)} Aberration correction phase applied onto the SLM, which is a fourth-order polynomial in the distance from the center.
		\textbf{f)} Cylindrical lens phase to account for aberration introduced by the SLM itself.
	}
	\label{fig:SLMphase}
\end{figure}

\subsection{Optical Flatness}\label{subsec:Flatness}

Because of manufacturing imperfections, the SLM chip will not be perfectly flat on the scale of the wavelength of the light used. 
The exact shape of the chip area is slightly different between individual SLM units.
The flatness of our chip was measured by manufacturer Meadowlark to have a RMS flatness of $\sim 0.18\lambdaup$ (785 nm).
The shape of the flatness was measured as well and provided to us by the manufacturer, so we can correct for it by subtracting a phase mask corresponding to the same non-flatness.
This mask is shown in \ref{fig:SLMphase}c.

\subsection{Diffraction Efficiency}\label{subsec:Diffraction}

Because the SLM has individual pixels with constant pitch $d$, the device acts effectively as a diffraction grating.
As a result, there will be light diverted to higher diffraction orders in both horizontal and vertical directions.
The SLM is calibrated to direct the most power a single the diffraction order (we call this the first order), but a fraction of light will be sent to higher diffraction orders as well.

In addition, apart from higher diffraction orders, there will always be a fraction of light that is not modulated.
This light originates from surface reflections, back reflections and unused space between the pixels and is focused to a single spot in the glass cell by the objective \cite{Bijnen2013}.
To get rid of this undesired light, typically a linear phase is superimposed on top of the hologram (tilt aberration) which translates the desired pattern away from the undiffracted light.
The type of linear phase used is shown in \cref{fig:SLMphase}.
This solution comes at the cost of slightly lower diffraction efficiency however. Subsequently, in the focus of the telescope shown in \cref{fig:SLMbeampath}b, this unmodulated light, as well as the higher diffraction orders are blocked by an iris. 

\subsection{Aberration Correction}\label{subsec:AberrationCorrection}

Now that the SLM has been introduced, we will explain more thoroughly how exactly we corrected for spherical aberration as introduced by the incorrect glass thickness (\cref{sec:Tweezer3D}).
We left off at \cref{eq:SphericalFocus}.
For paraxial rays ($\alpha_0 \rightarrow 0$), \cref{eq:SphericalFocus} reduces to $d(1-n_r)$. 
Subtracting this paraxial result from the case for general ray angles, which may contain large angles from \cref{eq:SphericalFocus} and Taylor expanding up to fourth order in $\alpha_0$ yields the difference in focus shift between the general and paraxial case of \cite{Iwaniuk2011}

\begin{equation}\label{eq:FocusDifference}
    \delta f_{\text{general}} - \delta f_{\text{paraxial}} \approx
    \frac{d \tan^2{\alpha_0}}{2n} (1-n_r^2) - \frac{3d \tan^4{\alpha_0}}{8n}(1-n_r^2)^2+\mathcal{O}(\tan\alpha_0^6).
\end{equation}
Multiplying \cref{eq:FocusDifference} with $2\pi(n-n_0)/\lambdaup$ and converting to a radial dependence as $\tan{\alpha_0}= \text{NA} \times r/R$ yields 

\begin{equation}\label{eq:ConversionRadial}
    \phi(r) \approx \frac{\pi d}{n\lambdaup}(1-n_r)\left[
    \left(\text{NA}\frac{r}{R}\right)^2(1-n_r^2)-\frac{3}{4}\left(\text{NA}\frac{r}{ R}\right)^4(1-n_r^2)^2
    \right].
\end{equation}
This is a function that can be decomposed in Zernike polynomials.
The Zernike polynomials are a set of orthogonal polynomials on the unit disk, related to optical aberrations. 
The coordinates on the unit disk can be denoted as $\rho = r/R$ and $\theta \in (0, 2\pi)$, such that the wavefront $\phi(\rho,\theta)$ can be expanded in terms $R_n^m(\rho)\cos{m\theta}$ and $R_n^m\sin{m\theta}$ where 

\begin{equation}\label{eq:ZernikeRadial}
    R_{n}^{m}(\rho)=
    \sum_{s=0}^{(n-m) / 2}
    \frac{(-1)^{s}(n-s) !}{s !\left((n+m)/2-s\right) !\left((n-m)/2-s\right) !} \rho^{n-2 s}
\end{equation}
is the radial Zernike polynomial set \cite{Mahajan94}. But it turns out \cref{eq:ConversionRadial} only has to nonzero $R_n^m$ terms: $R_2^2 \propto \rho^2$, which is a defocus aberration and $R_4^4 \propto \rho^4$ which is a third order spherical aberration. 
It is not needed to correct for the defocus (we do not care if the tweezer itself moves a micron in the axial direction, as long as we adjust the focus of the imaging system), leaving only the $\rho^4$ contribution, which is plotted in as a function of the radial coordinate on the SLM\footnote{Because the pupil of the microscope objective is conjugated with the short axis of the SLM, the radial coordinate $\rho =r/R$ also happens to apply on the SLM surface, if one substitutes $R=S_y$ (the short axis of the rectangular aperture).} in \cref{fig:AberrationTerm} and its corresponding hologram is presented in \cref{fig:SLMphase}e.

\begin{figure}
    \centering
    \includegraphics[width=0.45\textwidth]{figures/SphericalAberrationTerm.pdf}
    \caption{Phase correction in waves applied onto the SLM to correct the third order spherical aberration as a function of the normalized radial coordinate $\rho=r/R$.}
    \label{fig:AberrationTerm}
\end{figure}

Even after the spherical aberration correction, we still noted unsatisfactory performance in the axial direction as discussed in \cref{sec:Tweezer3D}. 
We think this is due to the lens phase on the SLM (\cref{fig:SLMLens}b): because the laser reflects off of the device, it effectively travels through a biconvex lens under this same angle (astigmatism aberration). 
This can cause the focus position to change slightly between $x$ and $y$, which would explain the increased Rayleigh range measured. 
We corrected for this by applying an additional lens phase only in the horizontal direction as shown in \cref{fig:SLMphase}f.


\section{Characterizing Tweezer Arrays}\label{sec:ArraysResults}

Using the \ac{GSW} algorithm implemented in Python code by Ivo Knottnerus, we generated holograms corresponding to $n \times n \times 1$ pixels in the $x$, $y$ and $z$-directions respectively, where $n = 1,2,\ldots 10$ (larger arrays are possibly, but cannot be fully imaged onto the CCD camera used because of the limited field of view in conjunction with the 0.85 NA objective). 
The algorithm was run until the uniformity $u$ reached 0.999. 
A typical hologram that was obtained is shown in \cref{fig:SLMphase}a.
Here, an example for a $7 \times 7$ array was used. 
In \cref{fig:SLMphase}b, the simulated diffraction pattern from this phase mask is shown. 
The units in this Fourier plane are so-called focal units, which are the Fourier transformed coordinates \cite{Bijnen2015}

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{figures/MaskAndComputedPattern.pdf}
    \caption{\textbf{a)} Hologram computed by the \ac{GSW} algorithm to compute a $7\times7$ spot array.
    \textbf{b)} Diffraction pattern as computed from the algorithm using the hologram in \textbf{a)} in focal units (\cref{eq:FocalUnit}.}
    \label{fig:HologramPattern}
\end{figure}

\begin{equation}\label{eq:FocalUnit}
    \Delta x \times \Delta y = \frac{\lambdaup f}{S_x}\times \frac{\lambdaup f}{S_y},
\end{equation}
where $S_x = 7.7$ mm and $S_y = 4.8$ mm are the semi-widths of the rectangular SLM aperture in $x$ and $y$ directions respectively.
Multiplying the spacing in focal units in \cref{fig:HologramPattern} with the definitions in \cref{eq:FocalUnit} will lead to a uniform spacing of $\sim 5$ $\mu$m in the Fourier plane. 
Because of non-integer spacing in focal units of the target pattern and the pixelated nature of the array of focal units in \ref{fig:HologramPattern}b, for some spots the peaks are spread out over multiple pixels, but this has no effect on the hologram itself: in the diffraction equation \cref{eq:Vm} the diffraction-limited spot area is considered, which does not have to line up with the pixels in \cref{fig:HologramPattern}b.

The $7\times7$ array as measured on the camera is shown in \cref{fig:CameraLoG}, where the only relevant section of the CCD chip is shown. 
We are mainly interested in the uniformity of the array, as well as the spot size.
To do this, we performed 2D Gaussian least-square fits (\cref{eq:2DGaussian}) as a function of the spot labeled $m$.

\begin{figure}
    \centering
    \includegraphics[width=0.9\textwidth]{figures/CamImgLoGSpots.pdf}
    \caption{\textbf{a)} $7\times7$ spot array as obtained from the Flea2 CCD chip.
    \textbf{b)} Spot locations marked with the red crosses, as obtained from the edge-detection algorithm. }
    \label{fig:CameraLoG}
\end{figure}

\begin{equation}\label{eq:2DGaussianNumberK}
    U_m(x,y) = U_{0,m}\exp{\left(\frac{-(x_m-x_{0,m})^2}{2\sigma_{x,m}^2}\right)}
    \exp{\left( \frac{-(y_m-y_{0,m})^2}{2\sigma_{y,}^2} \right)}.
\end{equation}
The fit is similar to the one shown in \cref{fig:3Dshowing}.
Each fit of spot $m$ has 5 fit parameters: the amplitude (optical trap depth) of the Gaussian: $U_{0,m}$, the center of the potential $(x_{0,m}, y_{0,m})$ and lastly the spread of the Gaussian in Cartesian coordinates $\{\sigma_{x,m},\sigma_{y,m}\}$.
Similar to the single tweezer of the previous chapter, the waist is obtained as $w_{0,m} = \sigma_{x,m}+\sigma_{y,m}$, a assumption valid for $\sigma_x\sim\sigma_y$.

In order to routinely perform each fit, a starting guess for the center of each potential is needed, after which a \ac{RoI} can be extracted similar to \cref{fig:3Dwaistfit}.
To reliably detect the expected number of spots, we used the \ac{LoG} edge detection algorithm \cite{Haralick1992}. This method works by computing the Laplacian of the discrete pixel array, where zero crossings above a certain threshold in the second derivative are marked as an edge (spot). 
To prevent marking noisy pixels as a peak, the array is convolved with a Gaussian filter first. 
The spots found by the algorithm are marked in \ref{fig:CameraLoG}b by red crosses. 
If the detected number of spots is too little or too high, the detection threshold can be adjusted, which we did not find to be necessary in practice. 

In \cref{fig:SpotsRoI}, the extracted \ac{RoI} by the \ac{LoG} algorithm is shown for the first 3 peaks. 
Subsequently, the center of the peaks as found by the 2D fit $(x_{0,m},y_{0,m})$ is marked with the red dot, where the $1/e^2$ radii are marked by circles. 
Subsequently, the extracted fit parameters can be used to perform some statistics.
Histograms of the obtained waist (left) as well as trap depths (right) for the same $7\times7$ array are presented in \cref{fig:Histograms}.
We fitted the data in the histograms to a normal distribution, yielding a waist of $w_0 = (0.89 \pm 0.03)$ $\mu$m, where the error denotes the standard deviation.

\begin{figure}
    \centering
    \includegraphics[width=0.7\textwidth]{figures/SpotsCropped_range12.pdf}
    \caption{Region of interest in pixels around the first 3 spots, as extracted by the Laplacian of Gaussian. 
    The centers $(x_{m,0},y_{m,0})$ as found by the 2D is shown by the red dot. 
    The obtained $1/e^2$ radius $w_{m,0}$ is denoted by the circles is drawn for each peak $m$ as well.}
    \label{fig:SpotsRoI}
\end{figure}



\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{figures/FittedHistograms.pdf}
    \caption{\textbf{a)} Distribution of the $1/e^2$ radius as measured from the spot array in \cref{fig:CameraLoG}a.
    \textbf{b)} Spread in the fitted depth of the potential $U_0$, normalized by the average trap depth $\left\langle U_0 \right\rangle$.
    Both are fit to a normal distribution.
    }
    \label{fig:Histograms}
\end{figure}

\subsubsection*{Homogeneity}

As a result of the slightly varying waist, there will also be a non-homogeneity (uniformity) in the intensities (trap depths) of the array.
There are other causes to the spread in uniformity as well.
For example, the diffraction efficiency of the SLM increases as one gets closer to the optical axis approximately as $\operatorname{sinc}^2\{
\pi/2 (\theta_{\text{m}}/\theta_{\text{m,max}})\}$ where $\theta$ is the deflection angle from the zeroth order \cite{Ebadi2021}.
We neglected this effect for now: because quite a strong separation phase ramp was used, this variation will be small.

The spread in trap depths is shown in \cref{fig:Histograms}.
Because we only care about the spread and not about the magnitude of the intensity (the former is dependent on camera sensitivity, dichroic filters and laser power used), we normalize by the average trap depth $\left\langle U_0 \right\rangle$, yielding for this array a spread of $\sim 10$\%, which we found to be fairly typical irrespective of the amount of spots in the array.
To our knowledge, there is no literature result of the measurement method used here to compare to, because in a cold atom experiment it is usually measured by an imaging system of similar \ac{NA} by

\begin{enumerate}
    \item Placing the camera after the glass cell. 
    In our case that the camera would have to be accompanied be an identical long-working distance microscope, to bridge the 30 mm outer thickness of the cell.
    This is the same principle as using a set of two in-vacuum high-NA aspheric lenses as done by \cite{Nogrette2014}.
    
    \item Separating Stark-shifted atomic fluorescence from ultra-cold atoms in tweezers recorded by the same high-NA lens used to produce the tweezer array \cite{Ebadi2021}.
\end{enumerate}
In both cases, the light travels twice through the high-NA lens and vacuum glass, which typically seems to yield a larger spread: \cite{Nogrette2014} found 19\% standard deviation uniformity whereas we found $10\%$.

As also shown by \cite{Nogrette2014}, it is also possible to improve this uniformity by iteratively adapting the weight factors in the \ac{GSW} algorithm in a feedback loop to achieve a non-homogeneity of $1.4\%$.
It is worth noting here that this correction can only be as good as the imaging system used to obtain the feedback. 
Thus, in the method 1) one has to be careful not to 'over-correct' for aberrations \cite{Labuhn2016}, as it is impossible to know if the aberrations really occur in the place of the atoms or are rather a result of the imaging system which will also have aberrations. 
Because of this, the latter method 2) of really looking at the Stark shift by the atomic fluorescence might be the more robust method because here the aberration picked up by the imaging system will be approximately the same aberration introduced by producing the tweezer array in the first place (as the same high-NA lens is used.)
Both methods 1) and 2) are possible to implement in our ultra-cold experiment, which we will introduce now.







